<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ ç»Ÿå©šæœŸæ‹©å‰ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e74c3c;
            --secondary: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --info: #3498db;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 10px; /* ç§»åŠ¨ç«¯å‡å°‘å¤–è¾¹è· */
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--danger) 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        header h1 {
            margin: 0;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
        }
        
        .input-section {
            flex: 1;
            min-width: 350px;
            padding: 30px;
            background: rgba(241, 242, 246, 0.5);
            border-right: 1px dashed #ddd;
        }
        
        .result-section {
            flex: 2;
            min-width: 450px;
            padding: 30px;
            position: relative;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        input[type="date"], select {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        input[type="date"]:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2);
        }
        
        button {
            background: linear-gradient(to right, var(--primary), var(--warning));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(231, 76, 60, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .result-container {
            margin-top: 20px;
            min-height: 300px;
        }
        
        .date-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px; /* å‡å°‘å¡ç‰‡é—´è· */
            min-height: 180px; /* ç•¥å¾®å‡å°‘æœ€å°é«˜åº¦ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary);
            transition: all 0.3s;
            position: relative;
            overflow: visible; /* è®©æç¤ºæ¡†å¯ä»¥æ˜¾ç¤º */
        }
        
        .date-card:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .date-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--warning));
        }
        
        .date-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .solar-date {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .solar-date i {
            color: var(--warning);
        }
        
        .lunar-date {
            color: #7f8c8d;
            font-size: 0.95rem;
            margin-top: 5px;
        }
        
        .ganzhi {
            background: linear-gradient(to right, var(--secondary), var(--warning));
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            cursor: help;
        }
        
        /* ä¸ºé.signå…ƒç´ æ·»åŠ tooltipæ ·å¼ */
        .ganzhi[data-tooltip],
        .detail-value[data-tooltip] {
            position: relative;
            cursor: help;
            outline: none;
        }
        
        .ganzhi[data-tooltip]::after,
        .detail-value[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
            white-space: normal;
            max-width: 360px;
            min-width: 200px;
            text-align: left;
            word-break: break-word;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 2000;
            transition: opacity 0.25s ease, visibility 0.25s ease, transform 0.25s ease;
            /* é»˜è®¤ä½ç½®ï¼šå·¦ä¸Šæ–¹ï¼Œé¿å…è¶…å‡ºå³è¾¹ç•Œ */
            bottom: calc(100% + 15px);
            right: 0; /* å³å¯¹é½åˆ°å…ƒç´ å³è¾¹ */
            transform: translateY(-8px);
        }
        
        .ganzhi[data-tooltip]::before,
        .detail-value[data-tooltip]::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            opacity: 0;
            visibility: hidden;
            z-index: 2001;
            transition: opacity 0.25s ease, visibility 0.25s ease;
            /* é»˜è®¤ä½ç½®ï¼šå·¦ä¸Šæ–¹çš„ç®­å¤´ */
            bottom: calc(100% + 7px);
            right: 20px; /* è·ç¦»å³è¾¹20px */
            transform: none;
            border-top-color: #2c3e50;
        }
        
        .ganzhi[data-tooltip]:hover::after,
        .ganzhi[data-tooltip]:focus::after,
        .detail-value[data-tooltip]:hover::after,
        .detail-value[data-tooltip]:focus::after {
            opacity: 1;
            visibility: visible;
            transform: none; /* ä¿®æ”¹ä¸ºæ— å˜æ¢ï¼Œä¿æŒå·¦ä¸Šä½ç½® */
        }
        
        .ganzhi[data-tooltip]:hover::before,
        .ganzhi[data-tooltip]:focus::before,
        .detail-value[data-tooltip]:hover::before,
        .detail-value[data-tooltip]:focus::before {
            opacity: 1;
            visibility: visible;
        }
        
        .details {
            display: flex;
            flex-wrap: wrap;
            margin-top: 15px;
            gap: 15px;
        }
        
        .detail-item {
            flex: 1;
            min-width: 150px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #95a5a6;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .stars {
            color: var(--warning);
            font-size: 1.3rem;
            letter-spacing: 3px;
        }
        
        .auspicious-signs {
            display: flex;
            flex-wrap: wrap;
            margin-top: 15px;
            gap: 10px;
        }
        
        .sign {
            background: #e8f8f5;
            color: var(--success);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
        }
        
        .sign i {
            font-size: 0.8rem;
        }
        
        .sign.lucky-number {
            background: #f0f8ff;
            color: var(--info);
        }
        
        .sign.traditional-star {
            background: linear-gradient(to right, #8e44ad, #9b59b6);
            color: white;
            font-weight: bold;
            border: 2px solid #8e44ad;
        }
        
        /* æ™ºèƒ½æç¤ºæ¡†æ ·å¼ - ä¼˜åŒ–ç‰ˆæœ¬ */
        .sign[data-tooltip] {
            position: relative;
            cursor: help;
            outline: none;
        }
        
        /* æç¤ºæ¡†ä¸»ä½“ */
        .sign[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
            white-space: normal;
            max-width: 360px;
            min-width: 200px;
            text-align: left;
            word-break: break-word;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 2000; /* æé«˜z-indexç¡®ä¿ä¸è¢«é®æŒ¡ */
            transition: opacity 0.25s ease, visibility 0.25s ease, transform 0.25s ease;
        }
        
        /* æç¤ºæ¡†ç®­å¤´ */
        .sign[data-tooltip]::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            opacity: 0;
            visibility: hidden;
            z-index: 2001; /* ç¡®ä¿ç®­å¤´åœ¨æç¤ºæ¡†ä¹‹ä¸Š */
            transition: opacity 0.25s ease, visibility 0.25s ease;
        }
        
        /* é»˜è®¤ä½ç½®ï¼šä¸Šæ–¹ (ä¿®æ”¹ä¸ºé»˜è®¤ä½ç½®) */
        .sign[data-tooltip]:not([data-tooltip-pos])::after,
        .sign[data-tooltip][data-tooltip-pos="top"]::after {
            bottom: calc(100% + 15px); /* å¢åŠ è·ç¦»é¿å…é®æŒ¡ */
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
        }
        .sign[data-tooltip]:not([data-tooltip-pos])::before,
        .sign[data-tooltip][data-tooltip-pos="top"]::before {
            bottom: calc(100% + 7px); /* ç›¸åº”è°ƒæ•´ç®­å¤´ä½ç½® */
            left: 50%;
            transform: translateX(-50%);
            border-top-color: #2c3e50;
        }
        
        /* ä½ç½®ï¼šä¸‹æ–¹ (ä¿®æ”¹ä¸ºéé»˜è®¤ä½ç½®) */
        .sign[data-tooltip][data-tooltip-pos="bottom"]::after {
            top: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%) translateY(8px);
        }
        .sign[data-tooltip][data-tooltip-pos="bottom"]::before {
            top: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            border-bottom-color: #2c3e50;
        }
        
        /* ä½ç½®ï¼šå³ä¾§ */
        .sign[data-tooltip][data-tooltip-pos="right"]::after {
            left: calc(100% + 12px);
            top: 50%;
            transform: translateY(-50%) translateX(8px);
        }
        .sign[data-tooltip][data-tooltip-pos="right"]::before {
            left: calc(100% + 4px);
            top: 50%;
            transform: translateY(-50%);
            border-right-color: #2c3e50;
        }
        
        /* ä½ç½®ï¼šå·¦ä¾§ */
        .sign[data-tooltip][data-tooltip-pos="left"]::after {
            right: calc(100% + 12px);
            top: 50%;
            transform: translateY(-50%) translateX(-8px);
        }
        .sign[data-tooltip][data-tooltip-pos="left"]::before {
            right: calc(100% + 4px);
            top: 50%;
            transform: translateY(-50%);
            border-left-color: #2c3e50;
        }
        
        /* è¾¹ç¼˜å¯¹é½ä¿®æ­£ */
        /* ä¸‹æ–¹/ä¸Šæ–¹ - å·¦å¯¹é½ */
        .sign[data-tooltip][data-tooltip-pos="bottom"][data-tooltip-align="left"]::after,
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-align="left"]::after {
            left: 0;
            transform: translateY(8px);
        }
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-align="left"]::after {
            transform: translateY(-8px);
        }
        .sign[data-tooltip][data-tooltip-pos="bottom"][data-tooltip-align="left"]::before,
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-align="left"]::before {
            left: 20px;
            transform: none;
        }
        
        /* ä¸‹æ–¹/ä¸Šæ–¹ - å³å¯¹é½ */
        .sign[data-tooltip][data-tooltip-pos="bottom"][data-tooltip-align="right"]::after,
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-align="right"]::after {
            right: 0;
            left: auto;
            transform: translateY(8px);
        }
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-align="right"]::after {
            transform: translateY(-8px);
        }
        .sign[data-tooltip][data-tooltip-pos="bottom"][data-tooltip-align="right"]::before,
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-align="right"]::before {
            right: 20px;
            left: auto;
            transform: none;
        }
        
        /* å·¦ä¾§/å³ä¾§ - é¡¶éƒ¨å¯¹é½ */
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-align-y="top"]::after,
        .sign[data-tooltip][data-tooltip-pos="right"][data-tooltip-align-y="top"]::after {
            top: 0;
            transform: translateX(8px);
        }
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-align-y="top"]::after {
            transform: translateX(-8px);
        }
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-align-y="top"]::before,
        .sign[data-tooltip][data-tooltip-pos="right"][data-tooltip-align-y="top"]::before {
            top: 20px;
            transform: none;
        }
        
        /* å·¦ä¾§/å³ä¾§ - åº•éƒ¨å¯¹é½ */
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-align-y="bottom"]::after,
        .sign[data-tooltip][data-tooltip-pos="right"][data-tooltip-align-y="bottom"]::after {
            bottom: 0;
            top: auto;
            transform: translateX(8px);
        }
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-align-y="bottom"]::after {
            transform: translateX(-8px);
        }
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-align-y="bottom"]::before,
        .sign[data-tooltip][data-tooltip-pos="right"][data-tooltip-align-y="bottom"]::before {
            bottom: 20px;
            top: auto;
            transform: none;
        }
        
        /* æ˜¾ç¤ºçŠ¶æ€ */
        .sign[data-tooltip]:hover::after,
        .sign[data-tooltip]:focus::after,
        .sign[data-tooltip][data-tooltip-open="true"]::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%);
        }
        .sign[data-tooltip]:hover::before,
        .sign[data-tooltip]:focus::before,
        .sign[data-tooltip][data-tooltip-open="true"]::before {
            opacity: 1;
            visibility: visible;
        }
        
        /* å„æ–¹å‘æ˜¾ç¤ºæ—¶çš„å˜æ¢é‡ç½® */
        .sign[data-tooltip][data-tooltip-pos="top"]:hover::after,
        .sign[data-tooltip][data-tooltip-pos="top"]:focus::after,
        .sign[data-tooltip][data-tooltip-pos="top"][data-tooltip-open="true"]::after {
            transform: translateX(-50%);
        }
        .sign[data-tooltip][data-tooltip-pos="right"]:hover::after,
        .sign[data-tooltip][data-tooltip-pos="right"]:focus::after,
        .sign[data-tooltip][data-tooltip-pos="right"][data-tooltip-open="true"]::after {
            transform: translateY(-50%);
        }
        .sign[data-tooltip][data-tooltip-pos="left"]:hover::after,
        .sign[data-tooltip][data-tooltip-pos="left"]:focus::after,
        .sign[data-tooltip][data-tooltip-pos="left"][data-tooltip-open="true"]::after {
            transform: translateY(-50%);
        }
        
        /* è¾¹ç¼˜å¯¹é½æ—¶çš„æ˜¾ç¤ºå˜æ¢ */
        .sign[data-tooltip][data-tooltip-align="left"]:hover::after,
        .sign[data-tooltip][data-tooltip-align="left"]:focus::after,
        .sign[data-tooltip][data-tooltip-align="left"][data-tooltip-open="true"]::after {
            transform: none;
        }
        .sign[data-tooltip][data-tooltip-align="right"]:hover::after,
        .sign[data-tooltip][data-tooltip-align="right"]:focus::after,
        .sign[data-tooltip][data-tooltip-align="right"][data-tooltip-open="true"]::after {
            transform: none;
        }
        .sign[data-tooltip][data-tooltip-align-y="top"]:hover::after,
        .sign[data-tooltip][data-tooltip-align-y="top"]:focus::after,
        .sign[data-tooltip][data-tooltip-align-y="top"][data-tooltip-open="true"]::after {
            transform: none;
        }
        .sign[data-tooltip][data-tooltip-align-y="bottom"]:hover::after,
        .sign[data-tooltip][data-tooltip-align-y="bottom"]:focus::after,
        .sign[data-tooltip][data-tooltip-align-y="bottom"][data-tooltip-open="true"]::after {
            transform: none;
        }
        
        .conflict-warning {
            background: #fdedec;
            color: var(--danger);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 5px solid var(--danger);
        }
        
        .conflict-warning i {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        /* æ–°å¢ï¼šç”Ÿè¾°ä¿¡æ¯é¢æ¿æ ·å¼ */
        .birth-info-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            width: 100%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .birth-info-title {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }
        
        .birth-info-content {
            display: flex;
            gap: 20px;
        }
        
        .groom-info, .bride-info {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .bride-info {
            border-left-color: var(--secondary);
        }
        
        .person-label {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05rem;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .person-label i {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .bride-info .person-label i {
            color: var(--secondary);
        }
        
        .birth-details {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #6c757d;
        }
        
        .birth-detail-item {
            margin-bottom: 6px;
            padding: 3px 0;
        }
        
        .birth-detail-item strong {
            color: var(--dark);
            display: inline-block;
            min-width: 50px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            border: 5px solid rgba(241, 242, 246, 0.8);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #95a5a6;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: #bdc3c7;
            margin-bottom: 15px;
        }
        
        .error-box {
            background: #fdedec;
            color: var(--danger);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 5px solid var(--danger);
        }
        
        .error-box i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .error-box h3 {
            margin: 10px 0;
            color: var(--danger);
        }
        
        .retry-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .retry-btn:hover {
            background: #a5281b;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px; /* è¿›ä¸€æ­¥å‡å°‘ç§»åŠ¨ç«¯å¤–è¾¹è· */
            }
            
            .container {
                margin: 0; /* ç§»åŠ¨ç«¯å»é™¤å¤–è¾¹è· */
                border-radius: 0; /* ç§»åŠ¨ç«¯å»é™¤åœ†è§’ */
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px dashed #ddd;
                padding: 20px 15px; /* å‡å°‘å·¦å³å†…è¾¹è· */
            }
            
            .result-section {
                padding: 20px 15px; /* å‡å°‘å·¦å³å†…è¾¹è· */
            }
            
            header {
                padding: 20px 15px; /* å‡å°‘å¤´éƒ¨å†…è¾¹è· */
            }
            
            header h1 {
                font-size: 1.8rem; /* é€‚å½“å‡å°æ ‡é¢˜å­—ä½“ */
            }
            
            header p {
                font-size: 1rem; /* é€‚å½“å‡å°å‰¯æ ‡é¢˜å­—ä½“ */
            }
            
            /* ç§»åŠ¨ç«¯ç”Ÿè¾°ä¿¡æ¯é¢æ¿é€‚é… */
            .birth-info-panel {
                padding: 15px 10px; /* å‡å°‘å†…è¾¹è· */
                margin-bottom: 20px;
                margin-left: -5px; /* å¾®è°ƒå·¦è¾¹è· */
                margin-right: -5px; /* å¾®è°ƒå³è¾¹è· */
            }
            
            .birth-info-title {
                font-size: 1rem;
                margin-bottom: 12px;
            }
            
            .birth-info-content {
                flex-direction: column;
                gap: 12px; /* å‡å°‘é—´è· */
            }
            
            .groom-info, .bride-info {
                padding: 12px 10px; /* å‡å°‘å†…è¾¹è· */
                margin: 0; /* å»é™¤å¤–è¾¹è· */
            }
            
            .person-label {
                font-size: 0.95rem;
                margin-bottom: 8px;
            }
            
            .birth-details {
                font-size: 0.85rem;
            }
            
            .birth-detail-item {
                margin-bottom: 4px; /* å‡å°‘é—´è· */
            }
            
            /* è¾“å…¥åŒºåŸŸä¼˜åŒ– */
            input[type="date"], select {
                padding: 12px 10px; /* é€‚å½“å‡å°‘å†…è¾¹è· */
                font-size: 0.95rem;
            }
            
            button {
                padding: 12px 20px; /* é€‚å½“å‡å°‘å†…è¾¹è· */
                font-size: 1rem;
            }
            
            /* æ—¥æœŸå¡ç‰‡ä¼˜åŒ– */
            .date-card {
                margin-bottom: 20px;
                padding: 15px 10px; /* å‡å°‘å†…è¾¹è· */
                margin-left: -5px; /* å¾®è°ƒå·¦è¾¹è· */
                margin-right: -5px; /* å¾®è°ƒå³è¾¹è· */
                border-left-width: 3px; /* å‡å°‘å·¦è¾¹è£…é¥°çº¿å®½åº¦ */
            }
            
            /* é˜³å†æ—¥æœŸå­—ä½“ä¼˜åŒ– */
            .solar-date {
                font-size: 1.1rem; /* ä»1.3remå‡å°‘åˆ°1.1rem */
            }
            
            .solar-date i {
                font-size: 1rem; /* ç›¸åº”è°ƒæ•´å›¾æ ‡å¤§å° */
            }
        }
        
        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            body {
                padding: 2px;
            }
            
            .container {
                box-shadow: none; /* å»é™¤é˜´å½± */
            }
            
            header {
                padding: 15px 10px;
            }
            
            header h1 {
                font-size: 1.6rem;
            }
            
            header p {
                font-size: 0.9rem;
            }
            
            .input-section, .result-section {
                padding: 15px 10px;
            }
            
            .birth-info-panel {
                margin-left: -8px;
                margin-right: -8px;
                padding: 12px 8px;
            }
            
            .date-card {
                margin-left: -8px;
                margin-right: -8px;
                padding: 12px 8px;
                border-left-width: 2px; /* è¿›ä¸€æ­¥å‡å°‘å·¦è¾¹è£…é¥°çº¿ */
            }
            
            /* è¶…å°å±å¹•é˜³å†æ—¥æœŸè¿›ä¸€æ­¥ä¼˜åŒ– */
            .solar-date {
                font-size: 1rem; /* è¿›ä¸€æ­¥å‡å°å­—ä½“ */
            }
            
            .solar-date i {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¼ ç»Ÿå©šæœŸæ‹©å‰ç³»ç»Ÿ</h1>
            <p>èåˆå¤©æ–‡å†æ³•ã€é˜´é˜³äº”è¡Œã€æ°‘ä¿—ç¦å¿Œçš„æ™ºèƒ½æ‹©æ—¥å·¥å…·</p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <div class="form-group">
                    <label for="male-birth"><i class="fas fa-male"></i> æ–°éƒå‡ºç”Ÿæ—¥æœŸ</label>
                    <input type="date" id="male-birth" value="1991-10-08" required min="1900-01-01" max="2100-12-31">
                </div>
                
                <div class="form-group">
                    <label for="female-birth"><i class="fas fa-female"></i> æ–°å¨˜å‡ºç”Ÿæ—¥æœŸ</label>
                    <input type="date" id="female-birth" value="1996-11-01" required min="1900-01-01" max="2100-12-31">
                </div>
                
                <div class="form-group">
                    <label for="start-date"><i class="fas fa-calendar-alt"></i> å¼€å§‹æŸ¥è¯¢æ—¥æœŸ</label>
                    <input type="date" id="start-date" required>
                </div>
                
                <div class="form-group">
                    <label for="search-range"><i class="fas fa-search"></i> æŸ¥è¯¢èŒƒå›´</label>
                    <select id="search-range">
                        <option value="180">6ä¸ªæœˆå†…</option>
                        <option value="365">1å¹´å†…</option>
                        <option value="730" selected>2å¹´å†…</option>
                        <option value="1825">5å¹´å†…</option>
                    </select>
                </div>
                
                <button id="calculate-btn">
                    <i class="fas fa-heart"></i> è®¡ç®—å‰æ—¥
                </button>
            </div>
            
            <div class="result-section">
                <h2><i class="fas fa-list-alt"></i> æ¨èå©šæœŸ</h2>
                
                <div class="birth-info-panel" id="birth-info-panel" style="display: none;">
                    <div class="birth-info-title">
                        <i class="fas fa-users"></i> æ–°äººç”Ÿè¾°ä¿¡æ¯
                    </div>
                    <div class="birth-info-content">
                        <div class="groom-info">
                            <div class="person-label">
                                <i class="fas fa-male"></i> æ–°éƒ
                            </div>
                            <div class="birth-details" id="groom-details"></div>
                        </div>
                        <div class="bride-info">
                            <div class="person-label">
                                <i class="fas fa-female"></i> æ–°å¨˜
                            </div>
                            <div class="birth-details" id="bride-details"></div>
                        </div>
                    </div>
                </div>
                
                <div id="conflict-warning" class="conflict-warning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div id="warning-text"></div>
                </div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨è®¡ç®—å‰æ—¥ï¼Œè¯·ç¨å€™...</p>
                </div>
                
                <div class="result-container" id="result-container">
                    <div class="empty-state">
                        <i class="fas fa-calendar-plus"></i>
                        <p>è¯·è¾“å…¥åŒæ–¹ç”Ÿæ—¥å¹¶ç‚¹å‡»è®¡ç®—æŒ‰é’®</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¤©å¹²åœ°æ”¯é…ç½®
        const TIANGAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
        const DIZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
        const SHENGXIAO = ["é¼ ", "ç‰›", "è™", "å…”", "é¾™", "è›‡", "é©¬", "ç¾Š", "çŒ´", "é¸¡", "ç‹—", "çŒª"];
        const WUXING = ["é‡‘", "é‡‘", "ç«", "ç«", "åœŸ", "åœŸ", "é‡‘", "é‡‘", "æ°´", "æ°´", "åœŸ", "åœŸ"];
        
        // åäºŒå»ºæ˜Ÿé…ç½®ï¼ˆä¼ ç»Ÿæ‹©æ—¥æ ¸å¿ƒï¼‰
        const TWELVE_BUILDERS = ["å»º", "é™¤", "æ»¡", "å¹³", "å®š", "æ‰§", "ç ´", "å±", "æˆ", "æ”¶", "å¼€", "é—­"];
        const BUILDER_TYPES = {
            'é»„é“': ['é™¤', 'å±', 'å®š', 'æ‰§', 'æˆ', 'å¼€'], // é»„é“å‰æ—¥
            'é»‘é“': ['å»º', 'æ»¡', 'å¹³', 'æ”¶', 'é—­', 'ç ´']  // é»‘é“å‡¶æ—¥
        };
        
        // å«å¨¶ä¸“ç”¨å®œå¿Œï¼ˆæ ¹æ®ä¼ ç»Ÿæ–‡åŒ–ï¼‰
        const MARRIAGE_SUITABLE = {
            'å»º': false, 'é™¤': true,  'æ»¡': false, 'å¹³': false,
            'å®š': true,  'æ‰§': true,  'ç ´': false, 'å±': false,
            'æˆ': true,  'æ”¶': true,  'å¼€': true,  'é—­': false
        };
        
        // ä¼ ç»Ÿå‡¶æ—¥é…ç½®
        const BAD_DAYS = {
            'ä¸‰å¨˜ç…': [3, 7, 13, 18, 22, 27], // æ¯æœˆçš„å‡¶æ—¥
            'æ¨å…¬å¿Œ': [
                [1, 13], [2, 11], [3, 9], [4, 7], [5, 5], [6, 3],
                [7, 1], [7, 29], [8, 27], [9, 25], [10, 23], [11, 21], [12, 19]
            ], // [æœˆ, æ—¥]
            'æœˆå¿Œ': [5, 14, 23], // æ¯æœˆå¿Œæ—¥
        };
        
        // å‰ç¥é…ç½®ï¼ˆä¼ ç»Ÿæ–‡åŒ–ä¸ºä¸»ï¼Œä¿ç•™åŸæœ‰ä½†è°ƒæ•´ä¼˜å…ˆçº§ï¼‰
        const JISHEN = {
            'å¤©å¾·': [[1,9], [2,7], [3,5], [4,3], [5,1], [6,9], [7,7], [8,5], [9,3], [10,1], [11,9], [12,7]],
            'æœˆå¾·': [[1,10], [2,10], [3,10], [4,10], [5,10], [6,10], [7,10], [8,10], [9,10], [10,10], [11,10], [12,10]],
            'å¤©å–œ': [[1,11], [2,12], [3,1], [4,2], [5,3], [6,4], [7,5], [8,6], [9,7], [10,8], [11,9], [12,10]],
            'ä¸‰åˆ': [[1,5], [2,9], [3,1], [4,5], [5,9], [6,1], [7,5], [8,9], [9,1], [10,5], [11,9], [12,1]],
            'å…­åˆ': [[1,6], [2,6], [3,6], [4,6], [5,6], [6,6], [7,6], [8,6], [9,6], [10,6], [11,6], [12,6]],
            'å¤©èµ¦': [[1,1], [2,19], [3,19], [4,17], [5,15], [6,13], [7,11], [8,9], [9,7], [10,5], [11,3], [12,1]] // å¤©èµ¦æ—¥
        };
        
        // ç”Ÿè‚–å†²å…‹å…³ç³»
        const SHENGXIAO_CONFLICTS = {
            'é¼ ': 'é©¬', 'ç‰›': 'ç¾Š', 'è™': 'çŒ´',
            'å…”': 'é¸¡', 'é¾™': 'ç‹—', 'è›‡': 'çŒª',
            'é©¬': 'é¼ ', 'ç¾Š': 'ç‰›', 'çŒ´': 'è™',
            'é¸¡': 'å…”', 'ç‹—': 'é¾™', 'çŒª': 'è›‡'
        };
        
        // åˆå§‹åŒ–æ—¥æœŸä¸ºä»Šå¤©
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const formattedDate = formatDate(today);
            document.getElementById('start-date').value = formattedDate;
            
            // æ·»åŠ æ•°å­—å‰æµ‹è¯•æŒ‰é’®ï¼ˆä»…åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ï¼‰
            if (window.location.search.includes('debug')) {
                const debugBtn = document.createElement('button');
                debugBtn.innerHTML = 'ğŸ” æµ‹è¯•æ•°å­—å‰';
                debugBtn.style.cssText = 'position:fixed;top:10px;right:10px;z-index:9999;padding:5px 10px;background:#f39c12;color:white;border:none;border-radius:5px;cursor:pointer;';
                debugBtn.onclick = testLuckyNumbers;
                document.body.appendChild(debugBtn);
            }
        });
        
        // æµ‹è¯•æ•°å­—å‰åŠŸèƒ½
        function testLuckyNumbers() {
            window.DEBUG_WEDDING = true;
            console.log('=== æ•°å­—å‰æµ‹è¯•å¼€å§‹ ===');
            console.log('è¿‡æ»¤è§„åˆ™ï¼šåªæœ‰æ•°å­—å‰è€Œæ²¡æœ‰å‰ç¥çš„æ—¥æœŸä¸æ˜¾ç¤º');
            
            // æµ‹è¯•ä¸€äº›åŒ…å«6,8,9çš„æ—¥æœŸ
            const testDates = [6, 8, 9, 16, 18, 19, 26, 28, 29];
            testDates.forEach(day => {
                const dayStr = day.toString();
                const isLucky = dayStr.includes('6') || dayStr.includes('8') || dayStr.includes('9');
                console.log(`æ—¥æœŸ ${day}: ${isLucky ? 'âœ… æ•°å­—å‰' : 'âŒ éæ•°å­—å‰'} - ä½†åªæœ‰æ•°å­—å‰çš„æ—¥æœŸä¸ä¼šæ˜¾ç¤º`);
            });
            
            alert('æ•°å­—å‰æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º');
        }
        
        // è®¡ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('calculate-btn').addEventListener('click', function() {
            const maleBirth = document.getElementById('male-birth').value;
            const femaleBirth = document.getElementById('female-birth').value;
            const startDate = document.getElementById('start-date').value;
            const searchRange = parseInt(document.getElementById('search-range').value);
            
            if (!validateInput(maleBirth, femaleBirth, startDate)) {
                return;
            }
            
            calculateAuspiciousDates(maleBirth, femaleBirth, startDate, searchRange);
        });
        
        // è¾“å…¥éªŒè¯
        function validateInput(maleBirth, femaleBirth, startDate) {
            if (!maleBirth || !femaleBirth || !startDate) {
                showError('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return false;
            }
            
            const maleDate = new Date(maleBirth);
            const femaleDate = new Date(femaleBirth);
            const start = new Date(startDate);
            
            if (isNaN(maleDate.getTime()) || isNaN(femaleDate.getTime()) || isNaN(start.getTime())) {
                showError('æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨YYYY-MM-DDæ ¼å¼');
                return false;
            }
            
            if (maleDate > new Date() || femaleDate > new Date()) {
                showError('å‡ºç”Ÿæ—¥æœŸä¸èƒ½æ™šäºä»Šå¤©');
                return false;
            }
            
            if (start < new Date(1900, 0, 1) || start > new Date(2100, 11, 31)) {
                showError('æŸ¥è¯¢æ—¥æœŸéœ€åœ¨1900-2100å¹´èŒƒå›´å†…');
                return false;
            }
            
            return true;
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const container = document.getElementById('result-container');
            container.innerHTML = `
                <div class="error-box">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>è¾“å…¥é”™è¯¯</h3>
                    <p>${message}</p>
                    <button class="retry-btn" onclick="clearError()">é‡æ–°è¾“å…¥</button>
                </div>
            `;
        }
        
        // æ¸…é™¤é”™è¯¯
        function clearError() {
            document.getElementById('result-container').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-calendar-plus"></i>
                    <p>è¯·è¾“å…¥åŒæ–¹ç”Ÿæ—¥å¹¶ç‚¹å‡»è®¡ç®—æŒ‰é’®</p>
                </div>
            `;
        }
        
        // ä¸»è®¡ç®—å‡½æ•°
        function calculateAuspiciousDates(maleBirth, femaleBirth, startDate, daysToSearch) {
            // æ˜¾ç¤ºåŠ è½½ä¸­
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result-container').innerHTML = '';
            document.getElementById('conflict-warning').style.display = 'none';
            
            // ä½¿ç”¨setTimeoutè®©UIæœ‰æœºä¼šæ›´æ–°
            setTimeout(() => {
                try {
                    // 1. è§£æè¾“å…¥æ—¥æœŸ
                    const maleDate = new Date(maleBirth);
                    const femaleDate = new Date(femaleBirth);
                    const start = new Date(startDate);
                    const endDate = new Date(start);
                    endDate.setDate(endDate.getDate() + daysToSearch);
                    
                    // 2. è®¡ç®—åŒæ–¹ç”Ÿè‚–å’Œå…«å­—
                    const maleInfo = calculateBirthInfo(maleDate);
                    const femaleInfo = calculateBirthInfo(femaleDate);
                    
                    // æ˜¾ç¤ºç”Ÿè‚–å†²çªè­¦å‘Š
                    checkShengxiaoConflict(maleInfo.shengxiao, femaleInfo.shengxiao);
                    
                    // 3. æŸ¥æ‰¾å‰æ—¥
                    const results = [];
                    let currentDate = new Date(start);
                    
                    while (currentDate <= endDate && results.length < 30) {
                        const dateInfo = checkAuspiciousDate(currentDate, maleInfo, femaleInfo);
                        if (dateInfo) {
                            results.push(dateInfo);
                        }
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    // 4. æ˜¾ç¤ºç»“æœå’Œç”Ÿè¾°ä¿¡æ¯
                    displayResults(results, maleInfo, femaleInfo);
                    displayBirthInfo(maleInfo, femaleInfo, maleDate, femaleDate);
                    
                } catch (error) {
                    console.error('è®¡ç®—é”™è¯¯:', error);
                    showCalculationError(error.message);
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            }, 100);
        }
        
        // æ£€æŸ¥ç”Ÿè‚–å†²çª
        function checkShengxiaoConflict(maleSx, femaleSx) {
            if (SHENGXIAO_CONFLICTS[maleSx] === femaleSx) {
                const warningText = `âš ï¸ ç”Ÿè‚–å†²çªï¼š${maleSx}ä¸${femaleSx}ç›¸å†²ï¼Œå»ºè®®é€‰æ‹©ä¸‰åˆæ—¥åŒ–è§£`;
                document.getElementById('warning-text').innerHTML = warningText;
                document.getElementById('conflict-warning').style.display = 'flex';
            }
        }
        
        // è®¡ç®—å‡ºç”Ÿä¿¡æ¯ï¼ˆç”Ÿè‚–ã€å…«å­—ç­‰ï¼‰
        function calculateBirthInfo(birthDate) {
            const year = birthDate.getFullYear();
            const month = birthDate.getMonth() + 1;
            const day = birthDate.getDate();
            
            // å¹²æ”¯å¹´è®¡ç®—ï¼ˆç®€åŒ–ï¼‰
            const ganzhiYearIndex = (year - 4) % 60;
            const yearGan = TIANGAN[ganzhiYearIndex % 10];
            const yearZhi = DIZHI[ganzhiYearIndex % 12];
            const shengxiao = SHENGXIAO[ganzhiYearIndex % 12];
            const wuxing = WUXING[ganzhiYearIndex % 12];
            
            // æ—¥å¹²æ”¯è®¡ç®—ï¼ˆç®€åŒ–ï¼‰
            const baseDate = new Date(1900, 0, 31); // 1900å¹´1æœˆ31æ—¥ä¸ºç”²å­æ—¥
            const deltaDays = Math.floor((birthDate - baseDate) / (1000 * 60 * 60 * 24));
            const ganzhiDayIndex = deltaDays % 60;
            const dayGan = TIANGAN[ganzhiDayIndex % 10];
            const dayZhi = DIZHI[ganzhiDayIndex % 12];
            const dayWuxing = WUXING[ganzhiDayIndex % 12];
            
            return {
                yearGanzhi: yearGan + yearZhi,
                shengxiao: shengxiao,
                yearWuxing: wuxing,
                dayGanzhi: dayGan + dayZhi,
                dayWuxing: dayWuxing,
                lunarDate: getLunarDateString(birthDate)
            };
        }
        
        // è·å–å†œå†æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆæ–¹æ¡ˆAï¼šä½¿ç”¨ Intl ä¸­æ–‡å†œå†ï¼Œå‡†ç¡®æ¢ç®—ï¼›ä¸æ”¯æŒæ—¶ä¼˜é›…é™çº§ï¼‰
        function getLunarDateString(date) {
            // ä¼˜å…ˆï¼šä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„ä¸­æ–‡å†œå†å†æ³•ï¼ˆå‡†ç¡®ã€ç»´æŠ¤æˆæœ¬ä½ï¼‰
            try {
                // ä½¿ç”¨ zh-CN è¯­ç³» + chinese å†æ³•ï¼Œåˆ†åˆ«å–å¹´ã€æœˆã€æ—¥ç”¨äºè‡ªå®šä¹‰æ‹¼è£…
                const fmt = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', { year: 'numeric', month: 'long', day: 'numeric' });
                const parts = fmt.formatToParts(date);
                let y = '', m = '', d = '';
                for (const p of parts) {
                    if (p.type === 'year') y = p.value;
                    if (p.type === 'month') m = p.value;    // å¯èƒ½åŒ…å«â€œé—°â€
                    if (p.type === 'day') d = p.value;
                }
                // æ­£å¸¸æƒ…å†µä¸‹ mã€d å¿…å®šå­˜åœ¨ï¼›å¹´åœ¨éƒ¨åˆ†å®ç°ä¸­å¯èƒ½ä¸ºç©ºæˆ–å·²åŒ…å«â€œå¹´â€å­—
                if (m && d) {
                    // ç»Ÿä¸€å¤„ç†å¹´åç¼€
                    const yearStr = y && !/å¹´$/.test(y) ? (y + 'å¹´ ') : (y ? (y + ' ') : '');
                    return `${yearStr}${m} ${d}`;
                }
            } catch (e) {
                // è‹¥ç¯å¢ƒä¸æ”¯æŒ chinese å†æ³•ï¼Œè¿›å…¥é™çº§
            }
            
            // é™çº§ï¼šå›é€€ä¸ºå…¬å†çš„ä¸­æ–‡æ ¼å¼å¹¶æ ‡æ³¨â€œï¼ˆç¤ºæ„ï¼‰â€ï¼Œé¿å…ä¸é˜³å†æ··æ·†
            return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ï¼ˆç¤ºæ„ï¼‰`;
        }
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºå‰æ—¥ï¼ˆæŒ‰ä¼ ç»Ÿæ–‡åŒ–é‡æ–°è®¾è®¡ï¼‰
        function checkAuspiciousDate(date, maleInfo, femaleInfo) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // 1. æ£€æŸ¥ä¼ ç»Ÿå‡¶æ—¥ï¼ˆä¼ ç»Ÿæ–‡åŒ–æœ€é‡è¦ï¼‰
            const badDayInfo = isBadDay(date);
            if (badDayInfo) {
                // ä¼ ç»Ÿå‡¶æ—¥ç›´æ¥æ’é™¤
                if (window.DEBUG_WEDDING) {
                    console.log(`${year}-${month}-${day}: ä¼ ç»Ÿå‡¶æ—¥ - ${badDayInfo.type}: ${badDayInfo.reason}`);
                }
                return null;
            }
            
            // 2. æ£€æŸ¥æœˆç ´æ—¥
            if (isMonthBreakDay(date)) {
                if (window.DEBUG_WEDDING) {
                    console.log(`${year}-${month}-${day}: æœˆç ´æ—¥ï¼Œä¸å®œåŠå©šäº‹`);
                }
                return null;
            }
            
            // 3. è®¡ç®—æ—¥å¹²æ”¯
            const baseDate = new Date(1900, 0, 31);
            const deltaDays = Math.floor((date - baseDate) / (1000 * 60 * 60 * 24));
            const ganzhiDayIndex = deltaDays % 60;
            const dayGan = TIANGAN[ganzhiDayIndex % 10];
            const dayZhi = DIZHI[ganzhiDayIndex % 12];
            const ganzhiDay = dayGan + dayZhi;
            
            // 4. æ£€æŸ¥æ˜¯å¦å†²æ–°äººå…«å­—ï¼ˆç®€åŒ–ï¼‰
            if (dayZhi === maleInfo.dayGanzhi[1] || dayZhi === femaleInfo.dayGanzhi[1]) {
                if (window.DEBUG_WEDDING) {
                    console.log(`${year}-${month}-${day}: å†²æ–°äººå…«å­—ï¼Œä¸å®œ`);
                }
                return null;
            }
            
            // 5. è®¡ç®—åäºŒå»ºæ˜Ÿï¼ˆä¼ ç»Ÿæ–‡åŒ–æ ¸å¿ƒï¼‰
            const builder = getTwelveBuilder(date);
            const isBuilderSuitable = MARRIAGE_SUITABLE[builder];
            
            // 6. æ£€æŸ¥å‰ç¥
            const auspiciousSigns = [];
            for (const [shen, days] of Object.entries(JISHEN)) {
                if (days.some(([m, d]) => m === month && d === day)) {
                    auspiciousSigns.push(shen);
                }
            }
            
            // 7. ä¼ ç»Ÿæ–‡åŒ–æ‹©æ—¥æ ¸å¿ƒé€»è¾‘ï¼šå¿…é¡»æ˜¯åäºŒå»ºæ˜Ÿå‰æ—¥æ‰èƒ½è€ƒè™‘
            if (!isBuilderSuitable) {
                if (window.DEBUG_WEDDING) {
                    console.log(`${year}-${month}-${day}: åäºŒå»ºæ˜Ÿ"${builder}"ä¸å®œå«å¨¶`);
                }
                return null;
            }
            
            // 8. åœ¨åäºŒå»ºæ˜Ÿå‰æ—¥çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è‡³å°‘æœ‰ä¸€ä¸ªä¼ ç»Ÿå‰ç¥
            if (auspiciousSigns.length === 0) {
                if (window.DEBUG_WEDDING) {
                    console.log(`${year}-${month}-${day}: åäºŒå»ºæ˜Ÿ"${builder}"å‰ï¼Œä½†ç¼ºå°‘ä¼ ç»Ÿå‰ç¥`);
                }
                return null;
            }
            
            // 9. è®¡ç®—æ¨èæŒ‡æ•°ï¼ˆå®Œå…¨åŸºäºä¼ ç»Ÿæ–‡åŒ–ï¼‰
            let score = 1;
            
            // åäºŒå»ºæ˜ŸåŠ åˆ†ï¼ˆä¼ ç»Ÿæ‹©æ—¥æ ¸å¿ƒï¼‰
            if (builder === 'æˆ' || builder === 'å¼€') score += 4; // æœ€å¥½çš„æ—¥å­
            else if (builder === 'é™¤' || builder === 'å®š') score += 3;
            else if (builder === 'æ”¶') score += 2;
            else if (builder === 'æ‰§') score += 1;
            
            // ä¼ ç»Ÿå‰ç¥åŠ åˆ†
            if (auspiciousSigns.includes('å¤©å¾·') || auspiciousSigns.includes('æœˆå¾·')) score += 3;
            if (auspiciousSigns.includes('å¤©èµ¦')) score += 3;
            if (auspiciousSigns.includes('å¤©å–œ')) score += 2;
            if (auspiciousSigns.includes('ä¸‰åˆ') || auspiciousSigns.includes('å…­åˆ')) score += 1;
            
            // è°ƒè¯•ä¿¡æ¯
            if (window.DEBUG_WEDDING) {
                console.log(`${year}-${month}-${day}: åäºŒå»ºæ˜Ÿ="${builder}", å‰ç¥=[${auspiciousSigns.join(',')}], è¯„åˆ†=${score}`);
            }
            
            // è½¬æ¢ä¸ºå†œå†
            const lunarDate = getLunarDateString(date);
            
            return {
                solarDate: new Date(date.getTime()),
                lunarDate: lunarDate,
                ganzhi: ganzhiDay,
                builder: builder, // åäºŒå»ºæ˜Ÿ
                signs: auspiciousSigns,
                score: Math.min(5, score),
                chongShengxiao: getChongShengxiao(dayZhi)
            };
        }
        
        // è·å–ç›¸å†²ç”Ÿè‚–
        function getChongShengxiao(zhi) {
            const index = DIZHI.indexOf(zhi);
            const conflictIndex = (index + 6) % 12;
            return SHENGXIAO[conflictIndex];
        }
        
        // æ–°å¢ï¼šè®¡ç®—åäºŒå»ºæ˜Ÿï¼ˆä¼ ç»Ÿæ‹©æ—¥æ ¸å¿ƒï¼‰
        function getTwelveBuilder(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // è®¡ç®—èŠ‚æ°”ï¼ˆç®€åŒ–ï¼‰
            const monthStart = new Date(year, month - 1, 1);
            const daysSinceMonthStart = Math.floor((date - monthStart) / (1000 * 60 * 60 * 24));
            
            // æ ¹æ®æœˆä»½è®¡ç®—å»ºæ—¥çš„åœ°æ”¯
            const buildZhi = (month + 1) % 12; // ç®€åŒ–è®¡ç®—
            
            // è®¡ç®—å½“æ—¥å¯¹åº”çš„åäºŒå»ºæ˜Ÿ
            const builderIndex = (daysSinceMonthStart + buildZhi) % 12;
            return TWELVE_BUILDERS[builderIndex];
        }
        
        // æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºä¼ ç»Ÿå‡¶æ—¥
        function isBadDay(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // æ£€æŸ¥ä¸‰å¨˜ç…æ—¥
            if (BAD_DAYS['ä¸‰å¨˜ç…'].includes(day)) {
                return { type: 'ä¸‰å¨˜ç…', reason: 'ä¸‰å¨˜ä¸åˆ©å«å¨¶ï¼Œä¼ è¯´ä¼šç ´åæ–°äººå–œäº‹' };
            }
            
            // æ£€æŸ¥æ¨å…¬å¿Œæ—¥
            for (const [badMonth, badDay] of BAD_DAYS['æ¨å…¬å¿Œ']) {
                if (month === badMonth && day === badDay) {
                    return { type: 'æ¨å…¬å¿Œ', reason: 'æ¨å…¬å¿Œæ—¥ï¼Œä¸å®œåŠå©šå«å–œäº‹' };
                }
            }
            
            // æ£€æŸ¥æœˆå¿Œæ—¥
            if (BAD_DAYS['æœˆå¿Œ'].includes(day)) {
                return { type: 'æœˆå¿Œ', reason: 'æœˆå¿Œæ—¥ï¼Œå¤ªé˜³ä¸å‡ºï¼Œä¸å®œåŠå©šäº‹' };
            }
            
            return null; // ä¸æ˜¯å‡¶æ—¥
        }
        
        // æ–°å¢ï¼šæ£€æŸ¥æœˆç ´æ—¥ï¼ˆä¸æœˆä»¤ç›¸å†²ï¼‰
        function isMonthBreakDay(date) {
            const month = date.getMonth() + 1;
            const dayZhi = DIZHI[(date.getDate() - 1) % 12];
            const monthZhi = DIZHI[(month + 1) % 12];
            
            // æ£€æŸ¥æ˜¯å¦ç›¸å†²ï¼ˆç›¸å·®6ä½ï¼‰
            const dayIndex = DIZHI.indexOf(dayZhi);
            const monthIndex = DIZHI.indexOf(monthZhi);
            return Math.abs(dayIndex - monthIndex) === 6;
        }

        // æ–°å¢ï¼šæ ¹æ®æ ‡å¿—åç§°è¿”å›ä¸“ä¸šè§£é‡Šæ–‡æ¡ˆï¼ˆç”¨äº tooltipï¼‰
        function getSignExplanation(sign, dayZhi) {
            const MAP = {
                å¤©å¾·: 'å¤©å¾·è´µäººé™ä¸´ï¼Œä¸»å’Œé¡ºåŠ©ç›Šï¼Œè´µäººè¿åŠ¿æ—ºç››\nè¡Œäº‹å¤šå¾—é•¿è¾ˆè´µäººç›¸åŠ©ï¼Œç‰¹åˆ«é€‚å®œå©šå«å–œåº†ã€æ±‚å’Œè°ˆåˆ¤ç­‰é‡è¦äº‹å®œ',
                æœˆå¾·: 'æœˆå¾·è´µäººç…§è€€ï¼Œä¸»äººç¼˜ä¸è´µæ°”ï¼Œé€¢å‡¶åŒ–å‰è½¬è¿\näººé™…å…³ç³»å’Œè°èæ´½ï¼Œç‰¹åˆ«é€‚å®œå©šå«åº†å…¸ã€ä¼šäº²è®¿å‹ç­‰ç¤¾äº¤æ´»åŠ¨',
                å¤©å–œ: 'å¤©å–œæ˜Ÿä¸´é—¨ï¼Œä¸»å–œåº†ç¼˜åˆ†ï¼Œå©šå§»ç¾æ»¡ä¹‹è±¡\næ„Ÿæƒ…è¿åŠ¿æä½³ï¼Œæ°”æ°›å’Œä¹èèï¼Œæ˜¯ä¸¾åŠå©šç¤¼è®¢ç›Ÿçš„ç»ä½³æ—¶æœº',
                ä¸‰åˆ: 'ä¸æ—¥æ”¯å½¢æˆä¸‰åˆå±€ï¼Œä¸»åˆå’ŒåŠ©åŠ›ï¼Œäº‹ä¸šçˆ±æƒ…åŒä¸°æ”¶\nå›¢é˜Ÿåˆä½œé¡ºåˆ©ï¼Œå¤«å¦»æ„Ÿæƒ…å’Œç¦ï¼Œç‰¹åˆ«åˆ©äºå©šå«ä¸é‡è¦åˆä½œäº‹å®œ',
                å…­åˆ: 'ä¸æ—¥æ”¯å…­åˆç›¸åº”ï¼Œä¸»è´µäººç›¸åˆï¼Œäººé™…å…³ç³»æä½³\nå®¹æ˜“å¾—åˆ°ä»–äººå¸®åŠ©æ”¯æŒï¼Œè´µäººè¿åŠ¿å¼ºåŠ²ï¼Œæ˜¯æˆå°±å¤§äº‹çš„å¥½æ—¶æœº',
                å¤©èµ¦: 'å¤©èµ¦æ—¥é™ä¸´äººé—´ï¼Œä¸Šå¤©èµ¦ç½ªæ¶ˆç¾ï¼Œä¸‡äº‹çš†å®œå¤§å‰\nè¯¸äº‹é¡ºé‚å¦‚æ„ï¼Œæ˜¯ä¼ ç»Ÿæ‹©æ—¥ä¸­æœ€ä¸ºå‰åˆ©çè´µçš„æ—¥å­ä¹‹ä¸€'
            };
            if (sign === 'ä¸‰åˆ' && dayZhi) return `ä¸æ—¥æ”¯${dayZhi}å½¢æˆä¸‰åˆå±€ï¼Œä¸»åˆå’ŒåŠ©åŠ›ï¼Œäº‹ä¸šçˆ±æƒ…åŒä¸°æ”¶\nå›¢é˜Ÿåˆä½œé¡ºåˆ©ï¼Œå¤«å¦»æ„Ÿæƒ…å’Œç¦ï¼Œç‰¹åˆ«åˆ©äºå©šå«ä¸é‡è¦åˆä½œäº‹å®œ`;
            if (sign === 'å…­åˆ' && dayZhi) return `ä¸æ—¥æ”¯${dayZhi}å…­åˆç›¸åº”ï¼Œä¸»è´µäººç›¸åˆï¼Œäººé™…å…³ç³»æä½³\nå®¹æ˜“å¾—åˆ°ä»–äººå¸®åŠ©æ”¯æŒï¼Œè´µäººè¿åŠ¿å¼ºåŠ²ï¼Œæ˜¯æˆå°±å¤§äº‹çš„å¥½æ—¶æœº`;
            return MAP[sign] || 'ä¼ ç»Ÿå‰ç¥æŠ¤ä½‘ï¼Œåˆ©äºå©šå«ä¸äººé™…å’Œè°';
        }
        
        // æ–°å¢ï¼šè·å–åäºŒå»ºæ˜Ÿçš„è¯¦ç»†è§£é‡Š
        function getBuilderExplanation(builder) {
            const builderDesc = {
                'å»º': 'å»ºæ—¥ï¼šå»ºç«‹å¼€åˆ›ä¹‹æ„ï¼Œå±é»‘é“æ—¥ï¼Œæ°”åœºè¾ƒä¸ºå†²åŠ¨\né€‚å®œå‡ºè¡Œèµ´ä»»ã€å¼€å·¥å»ºè®¾ï¼Œä½†ä¸å®œå©šå«å–œåº†ã€åŠ¨åœŸå®‰è‘¬ç­‰äº‹',
                'é™¤': 'é™¤æ—¥ï¼šé™¤æ—§å¸ƒæ–°ä¹‹æ„ï¼Œå±é»„é“å‰æ—¥ï¼Œæ¸…æ–°æ°”åœº\nç‰¹åˆ«é€‚å®œå©šå«ç¥–ç¦ã€å‡ºè¡Œæ±‚åŒ»ã€æ¸…æ´æ•´ç†ï¼Œè¯¸äº‹å‰åˆ©é¡ºé‚',
                'æ»¡': 'æ»¡æ—¥ï¼šåœ†æ»¡å……å®ä¹‹æ„ï¼Œå±é»‘é“æ—¥ï¼Œå®¹æ˜“è¿‡æ»¡åˆ™äº\né€‚å®œä¿®å»ºä»“åº“ã€åº†ç¥ç¥è´ºï¼Œä½†ä¸å®œå©šå«å‡ºè¡Œã€ç­¾çº¦åˆä½œ',
                'å¹³': 'å¹³æ—¥ï¼šå¹³å’Œä¸­åº¸ä¹‹æ„ï¼Œå±é»‘é“æ—¥ï¼Œæ°”åœºå¹³æ·¡æ— å¥‡\nè¯¸äº‹å¹³å¸¸æ— å¤§å‰å‡¶ï¼Œå¯å¤„ç†æ—¥å¸¸äº‹åŠ¡ï¼Œä½†ä¸å®œé‡è¦å†³ç­–',
                'å®š': 'å®šæ—¥ï¼šå®‰å®šç¨³å›ºä¹‹æ„ï¼Œå±é»„é“å‰æ—¥ï¼Œæœ€åˆ©å®‰å®šäº‹å®œ\nç‰¹åˆ«é€‚å®œå©šå«è®¢ç›Ÿã€å®‰åºŠå®šå±…ã€ç­¾çº¦åˆä½œï¼Œå¤§å‰å¤§åˆ©',
                'æ‰§': 'æ‰§æ—¥ï¼šæ‰§è¡ŒåšæŒä¹‹æ„ï¼Œå±é»„é“å‰æ—¥ï¼Œåˆ©äºå®æ–½è®¡åˆ’\né€‚å®œå©šå«åº†å…¸ã€åŒ»ç–—æ²»ç—…ã€æ‰§è¡Œå†³å®šï¼Œä½†å‡ºè¡Œéœ€è°¨æ…',
                'ç ´': 'ç ´æ—¥ï¼šç ´åå†²çªä¹‹æ„ï¼Œå±é»‘é“å‡¶æ—¥ï¼Œæœ€ä¸å®œå–œåº†\nä»…é€‚å®œæ²»ç—…æ‹†é™¤ã€ç ´æ—§ç«‹æ–°ï¼Œå…¶ä»–é‡è¦äº‹å®œçš†ä¸å®œè¿›è¡Œ',
                'å±': 'å±æ—¥ï¼šé«˜å±è°¨æ…ä¹‹æ„ï¼Œå±é»„é“æ—¥ï¼Œéœ€è¦å°å¿ƒè¡Œäº‹\né€‚å®œå©šå«å®‰åºŠã€è°¨æ…å†³ç­–ï¼Œä½†ç™»é«˜å†’é™©ã€å¤§èƒ†è¡ŒåŠ¨ä¸å®œ',
                'æˆ': 'æˆæ—¥ï¼šæˆåŠŸè¾¾æˆä¹‹æ„ï¼Œå±æœ€å‰åˆ©æ—¥å­ï¼Œä¸‡äº‹çš†å®œ\nç‰¹åˆ«é€‚å®œå©šå«å¼€ä¸šã€é‡è¦åº†å…¸ã€ç­¾çº¦åˆä½œï¼Œè¯¸äº‹çš†èƒ½æˆåŠŸ',
                'æ”¶': 'æ”¶æ—¥ï¼šæ”¶è·å‚¨è—ä¹‹æ„ï¼Œå±é»‘é“æ—¥ï¼Œåˆ©äºæ”¶è—æ•´ç†\né€‚å®œå©šå«æ”¶çº³ã€å‚¨è“„ç†è´¢ã€æ€»ç»“æ”¶å°¾ï¼Œä½†å¼€ä¸šæ‰©å±•ä¸å®œ',
                'å¼€': 'å¼€æ—¥ï¼šå¼€å¯å‘å±•ä¹‹æ„ï¼Œå±æœ€å‰åˆ©æ—¥å­ï¼Œç”Ÿæœºå‹ƒå‹ƒ\nç‰¹åˆ«é€‚å®œå©šå«å¼€ä¸šã€å‡ºè¡Œæ‹“å±•ã€æ–°é¡¹ç›®å¯åŠ¨ï¼Œå¤§å‰å¤§åˆ©',
                'é—­': 'é—­æ—¥ï¼šé—­å¡é˜»æ»ä¹‹æ„ï¼Œå±é»‘é“å‡¶æ—¥ï¼Œæ°”åœºå°é—­å‹æŠ‘\nä»…é€‚å®œä¿®å»ºå®‰è‘¬ã€å†…çœä¿®å…»ï¼Œå…¶ä»–é‡è¦å–œåº†äº‹å®œçš†ä¸å®œ'
            };
            
            const isGoodDay = BUILDER_TYPES['é»„é“'].includes(builder);
            const dayType = isGoodDay ? 'é»„é“å‰æ—¥' : 'é»‘é“æ—¥';
            
            return builderDesc[builder] || `${builder}æ—¥ï¼š${dayType}ç‰¹å¾æ˜æ˜¾\nè¯·å‚è€ƒä¼ ç»Ÿæ‹©æ—¥æ–‡çŒ®äº†è§£è¯¦ç»†å®œå¿Œäº‹é¡¹`;
        }
        
        // æ–°å¢ï¼šè·å–å¹²æ”¯çš„è¯¦ç»†è§£é‡Š
        function getGanzhiExplanation(ganzhi) {
            if (!ganzhi || ganzhi.length < 2) return 'å¹²æ”¯ä¿¡æ¯';
            const gan = ganzhi[0];
            const zhi = ganzhi[1];
            
            const ganMeaning = {
                'ç”²': 'é˜³æœ¨ï¼šè±¡å¾ç”Ÿé•¿åˆ›æ–°ï¼Œä¸»ç§¯æå‘ä¸Šï¼Œå…·æœ‰å¼€æ‹“ç²¾ç¥',
                'ä¹™': 'é˜´æœ¨ï¼šè±¡å¾æŸ”å’Œé€‚åº”ï¼Œä¸»æ¸©å’ŒåŒ…å®¹ï¼Œå…·æœ‰éŸ§æ€§ç¾å¾·',
                'ä¸™': 'é˜³ç«ï¼šè±¡å¾å…‰æ˜çƒ­æƒ…ï¼Œä¸»æ´»åŠ›å……æ²›ï¼Œå…·æœ‰é¢†å¯¼é­…åŠ›',
                'ä¸': 'é˜´ç«ï¼šè±¡å¾æ¸©æš–ç»†è‡´ï¼Œä¸»æ–‡é›…ç²¾è‡´ï¼Œå…·æœ‰è‰ºæœ¯æ°”è´¨',
                'æˆŠ': 'é˜³åœŸï¼šè±¡å¾ç¨³é‡åšå®ï¼Œä¸»å¯é è¸å®ï¼Œå…·æœ‰æ‰¿è½½åŠ›é‡',
                'å·±': 'é˜´åœŸï¼šè±¡å¾åŒ…å®¹å…»è‚²ï¼Œä¸»æ¸©å’Œæ…ˆç¥¥ï¼Œå…·æœ‰æ¯æ€§å…‰è¾‰',
                'åºš': 'é˜³é‡‘ï¼šè±¡å¾åˆšå¼ºæœæ–­ï¼Œä¸»åšæ¯…å†³æ–­ï¼Œå…·æœ‰é©æ–°èƒ½åŠ›',
                'è¾›': 'é˜´é‡‘ï¼šè±¡å¾ç²¾è‡´æ•é”ï¼Œä¸»èªæ…§çµå·§ï¼Œå…·æœ‰ç¾å­¦å“å‘³',
                'å£¬': 'é˜³æ°´ï¼šè±¡å¾æ™ºæ…§æµåŠ¨ï¼Œä¸»èªæ˜çµæ´»ï¼Œå…·æœ‰å˜é€šæ™ºæ…§',
                'ç™¸': 'é˜´æ°´ï¼šè±¡å¾æ¶¦æ³½åŒ…å®¹ï¼Œä¸»æŸ”å’Œæ»‹æ¶¦ï¼Œå…·æœ‰å…»è‚²ä¹‹åŠŸ'
            };
            
            const zhiMeaning = {
                'å­': 'å­æ—¶é¼ å¹´ï¼šä¸»æœºæ™ºçµæ´»ï¼Œé€‚åˆæ–°çš„å¼€å§‹ï¼Œåˆ©äºåˆåˆ›äº‹ä¸š',
                'ä¸‘': 'ä¸‘æ—¶ç‰›å¹´ï¼šä¸»è¸å®å‹¤å¥‹ï¼Œå®œç¨³é‡è¡Œäº‹ï¼Œåˆ©äºæŒä¹…ç»è¥',
                'å¯…': 'å¯…æ—¶è™å¹´ï¼šä¸»å‹‡çŒ›è¿›å–ï¼Œåˆ©äºæ‹“å±•ï¼Œé€‚åˆå¼€åˆ›æ–°å±€é¢',
                'å¯': 'å¯æ—¶å…”å¹´ï¼šä¸»æ¸©å’Œè°¨æ…ï¼Œå®œå’Œè°ç›¸å¤„ï¼Œåˆ©äºäººé™…å…³ç³»',
                'è¾°': 'è¾°æ—¶é¾™å¹´ï¼šä¸»å‰ç¥¥å¦‚æ„ï¼Œåˆ©äºé‡è¦äº‹å®œï¼Œå…·æœ‰é¾™å¾·ç¥å¨',
                'å·³': 'å·³æ—¶è›‡å¹´ï¼šä¸»æ™ºæ…§æ·±æ²‰ï¼Œå®œæ·±æ€ç†Ÿè™‘ï¼Œåˆ©äºç­–åˆ’å†³ç­–',
                'åˆ': 'åˆæ—¶é©¬å¹´ï¼šä¸»çƒ­æƒ…å¥”æ”¾ï¼Œåˆ©äºç§¯æè¡ŒåŠ¨ï¼Œé€‚åˆå¤§èƒ†è¿›å–',
                'æœª': 'æœªæ—¶ç¾Šå¹´ï¼šä¸»æ¸©å’Œå‹å–„ï¼Œå®œåˆä½œå…±äº‹ï¼Œåˆ©äºå›¢é˜Ÿåä½œ',
                'ç”³': 'ç”³æ—¶çŒ´å¹´ï¼šä¸»æœºæ™ºçµå·§ï¼Œåˆ©äºå˜é€šï¼Œé€‚åˆçµæ´»åº”å˜',
                'é…‰': 'é…‰æ—¶é¸¡å¹´ï¼šä¸»å®ˆæ—¶å‹¤å‹‰ï¼Œå®œæŒ‰æ—¶è¡Œäº‹ï¼Œåˆ©äºè§„åˆ’æ‰§è¡Œ',
                'æˆŒ': 'æˆŒæ—¶ç‹—å¹´ï¼šä¸»å¿ è¯šå¯é ï¼Œåˆ©äºæ‰¿è¯ºï¼Œé€‚åˆé•¿æœŸåˆä½œ',
                'äº¥': 'äº¥æ—¶çŒªå¹´ï¼šä¸»è¯šå®åšé“ï¼Œå®œè¯šä¿¡å¾…äººï¼Œåˆ©äºå»ºç«‹ä¿¡ä»»'
            };
            
            const ganDesc = ganMeaning[gan] || 'å¤©å¹²';
            const zhiDesc = zhiMeaning[zhi] || 'åœ°æ”¯';
            
            return `${ganzhi}æ—¥ï¼š${ganDesc}\n${zhiDesc}ï¼Œç»¼åˆæ°”åœºåˆ©äºæ‹©å‰è¡Œäº‹`;
        }
        
        // æ–°å¢ï¼šè·å–ç”Ÿè‚–å†²çš„è¯¦ç»†è§£é‡Š
        function getChongExplanation(chongShengxiao, currentGanzhi) {
            // æ ¹æ®ç½‘ç»œæœç´¢çš„ä¼ ç»Ÿç”Ÿè‚–å†²çŸ¥è¯†ï¼Œå®Œå–„è§£é‡Š
            const chongDesc = {
                'é¼ ': 'ä¸é©¬ç›¸å†²ï¼ˆå­åˆç›¸å†²ï¼‰\näº”è¡Œå¯¹ç«‹ï¼Œä¸»æ€§æ ¼è§‚å¿µç›¸å·®æå¤§ï¼Œéœ€è°¨æ…æ‹©æ—¥',
                'ç‰›': 'ä¸ç¾Šç›¸å†²ï¼ˆä¸‘æœªç›¸å†²ï¼‰\nåœŸåœŸç›¸å†²ï¼Œä¸»å›ºæ‰§å·±è§ï¼Œå®œé¿å…å†²çªæ—¶æœº',
                'è™': 'ä¸çŒ´ç›¸å†²ï¼ˆå¯…ç”³ç›¸å†²ï¼‰\næœ¨é‡‘ç›¸å…‹ï¼Œä¸»æ„è§åˆ†æ­§ï¼Œéœ€åŒ–è§£å†²å…‹ä¹‹åŠ›',
                'å…”': 'ä¸é¸¡ç›¸å†²ï¼ˆå¯é…‰ç›¸å†²ï¼‰\næœ¨é‡‘ç›¸å…‹ï¼Œä¸»äº‰æ‰§ä¸å’Œï¼Œå®œé€‰ä¸‰åˆæ—¥åŒ–è§£',
                'é¾™': 'ä¸ç‹—ç›¸å†²ï¼ˆè¾°æˆŒç›¸å†²ï¼‰\nåœŸåœŸç›¸å†²ï¼Œä¸»å†²çªçŸ›ç›¾ï¼Œéœ€é¿å¼€å†²æ—¥è¡Œäº‹',
                'è›‡': 'ä¸çŒªç›¸å†²ï¼ˆå·³äº¥ç›¸å†²ï¼‰\nç«æ°´ä¸å®¹ï¼Œä¸»ç†å¿µå¯¹ç«‹ï¼Œå®œæ‹©åˆæ—¥ä¸ºä½³',
                'é©¬': 'ä¸é¼ ç›¸å†²ï¼ˆåˆå­ç›¸å†²ï¼‰\nç«æ°´ç›¸å…‹ï¼Œä¸»æ€¥èºå†²åŠ¨ï¼Œéœ€é€‰å‰æ—¥å¹³å’Œ',
                'ç¾Š': 'ä¸ç‰›ç›¸å†²ï¼ˆæœªä¸‘ç›¸å†²ï¼‰\nåœŸåœŸç›¸å†²ï¼Œä¸»è§‚å¿µä¸åˆï¼Œå®œé¿å…æ­¤æ—¶æœº',
                'çŒ´': 'ä¸è™ç›¸å†²ï¼ˆç”³å¯…ç›¸å†²ï¼‰\né‡‘æœ¨ç›¸å…‹ï¼Œä¸»å˜åŠ¨ä¸å®‰ï¼Œéœ€åŒ–è§£å†²å…‹å½±å“',
                'é¸¡': 'ä¸å…”ç›¸å†²ï¼ˆé…‰å¯ç›¸å†²ï¼‰\né‡‘æœ¨ç›¸å…‹ï¼Œä¸»äº‰è®®é¢‘å‘ï¼Œå®œé€‰åˆè°ä¹‹æ—¥',
                'ç‹—': 'ä¸é¾™ç›¸å†²ï¼ˆæˆŒè¾°ç›¸å†²ï¼‰\nåœŸåœŸç›¸å†²ï¼Œä¸»å›ºæ‰§å¯¹ç«‹ï¼Œéœ€é¿å¼€ä¸åˆ©æ—¶æ—¥',
                'çŒª': 'ä¸è›‡ç›¸å†²ï¼ˆäº¥å·³ç›¸å†²ï¼‰\næ°´ç«ä¸å®¹ï¼Œä¸»æƒ…ç»ªæ³¢åŠ¨ï¼Œå®œæ‹©ä¸‰åˆæ—¥è¡Œäº‹'
            };
            
            return `ç”Ÿè‚–å†²ï¼š${chongDesc[chongShengxiao] || 'æ­¤æ—¥ä¸æŸç”Ÿè‚–ç›¸å†²ï¼Œå®œè°¨æ…æ‹©æ—¶'}`;
        }
        
        // æ–°å¢ï¼šè·å–äº”è¡Œçš„è¯¦ç»†è§£é‡Š
        function getWuxingExplanation(wuxing, ganzhi) {
            const wuxingDesc = {
                'é‡‘': 'é‡‘æ€§ï¼šä¸»æ”¶æ•›ã€åšæ¯…ã€æœæ–­ã€‚é‡‘æ—¥å®œç­¾çº¦ã€å†³ç­–ã€åº„é‡ä»ªå¼ï¼Œè±¡å¾åšå›ºæŒä¹…çš„æ‰¿è¯º',
                'æœ¨': 'æœ¨æ€§ï¼šä¸»ç”Ÿé•¿ã€åˆ›æ–°ã€å‘ä¸Šã€‚æœ¨æ—¥å®œå¼€å§‹æ–°äº‹ã€ç§æ¤ã€æ•™è‚²ï¼Œè±¡å¾ç”Ÿæœºå‹ƒå‹ƒçš„æœªæ¥',
                'æ°´': 'æ°´æ€§ï¼šä¸»æ™ºæ…§ã€æµåŠ¨ã€åŒ…å®¹ã€‚æ°´æ—¥å®œæ²Ÿé€šã€å­¦ä¹ ã€é€‚åº”ï¼Œè±¡å¾æ™ºæ…§ä¸å’Œè°',
                'ç«': 'ç«æ€§ï¼šä¸»çƒ­æƒ…ã€å…‰æ˜ã€æ´»è·ƒã€‚ç«æ—¥å®œåº†ç¥ã€è¡¨è¾¾ã€è¡ŒåŠ¨ï¼Œè±¡å¾çƒ­çƒˆä¸å…‰æ˜',
                'åœŸ': 'åœŸæ€§ï¼šä¸»ç¨³é‡ã€åŒ…å®¹ã€åšå¾·ã€‚åœŸæ—¥å®œå¥ åŸºã€æ‰¿è¯ºã€ç¨³å®šï¼Œè±¡å¾è¸å®ä¸å¯é '
            };
            
            return `äº”è¡Œ${wuxing}ï¼š${wuxingDesc[wuxing] || 'äº”è¡Œå±æ€§ï¼Œå½±å“å½“æ—¥æ°”åœºä¸å®œå¿Œ'}`;
        }

        // æ–°å¢ï¼šè½¬ä¹‰ç”¨äº HTML å±æ€§çš„ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢ç ´å data-tooltip
        function escapeAttr(text) {
            return String(text)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }

        // ä¼˜åŒ–çš„ tooltip å°ºå¯¸æµ‹é‡å‡½æ•°
        function measureTooltipSize(el) {
            const text = el.getAttribute('data-tooltip') || '';
            if (!text) return { w: 0, h: 0 };
            
            // åˆ›å»ºä¸´æ—¶æµ‹é‡å…ƒç´ 
            const tmp = document.createElement('div');
            tmp.className = 'sign';
            tmp.setAttribute('data-tooltip', text);
            tmp.style.cssText = `
                position: absolute;
                visibility: hidden;
                pointer-events: none;
                z-index: -1;
                top: -9999px;
                left: -9999px;
            `;
            
            // æ·»åŠ ä¼ªå…ƒç´ æ ·å¼
            tmp.innerHTML = `<style>
                .temp-tooltip::after {
                    content: attr(data-tooltip);
                    position: absolute;
                    background: #2c3e50;
                    color: #ecf0f1;
                    padding: 12px 16px;
                    border-radius: 8px;
                    font-size: 13px;
                    line-height: 1.6;
                    white-space: normal;
                    max-width: 360px;
                    min-width: 200px;
                    text-align: left;
                    word-break: break-word;
                    opacity: 1;
                    visibility: visible;
                }
            </style>`;
            
            tmp.classList.add('temp-tooltip');
            document.body.appendChild(tmp);
            
            // è·å–ä¼ªå…ƒç´ çš„å°ºå¯¸ï¼ˆä½¿ç”¨æ›´å‡†ç¡®çš„è®¡ç®—ï¼‰
            const rect = tmp.getBoundingClientRect();
            const computedStyle = window.getComputedStyle(tmp, '::after');
            
            // è®¡ç®—æ–‡æœ¬å®é™…å ç”¨å°ºå¯¸ï¼Œè€ƒè™‘æ¢è¡Œå’Œå¡«å……
            const lines = text.split('\n');
            const maxLineLength = Math.max(...lines.map(line => line.length));
            const estimatedWidth = Math.min(360, Math.max(200, maxLineLength * 10 + 32)); // åŠ ä¸Š padding
            const estimatedHeight = lines.length * 20 + 24; // æ¯è¡Œ20pxé«˜åº¦ + padding
            
            const w = parseInt(computedStyle.width) || estimatedWidth;
            const h = parseInt(computedStyle.height) || estimatedHeight;
            
            document.body.removeChild(tmp);
            return { w, h };
        }
        
        // æ™ºèƒ½å®šä½ç®—æ³• - ä¼˜åŒ–ç‰ˆæœ¬
        function setTooltipPosition(el) {
            try {
                // è·å–å…ƒç´ ä½ç½®ä¿¡æ¯
                const rect = el.getBoundingClientRect();
                const scrollX = window.pageXOffset || document.documentElement.scrollLeft;
                const scrollY = window.pageYOffset || document.documentElement.scrollTop;
                const vw = window.innerWidth || document.documentElement.clientWidth;
                const vh = window.innerHeight || document.documentElement.clientHeight;
                
                // æµ‹é‡tooltipå°ºå¯¸
                const { w: tooltipWidth, h: tooltipHeight } = measureTooltipSize(el);
                const margin = 16; // å®‰å…¨è¾¹è·
                const arrowSize = 8; // ç®­å¤´å¤§å°
                
                // è®¡ç®—å„æ–¹å‘çš„å¯ç”¨ç©ºé—´
                const space = {
                    top: rect.top + scrollY,
                    bottom: vh - (rect.bottom - scrollY),
                    left: rect.left + scrollX,
                    right: vw - (rect.right - scrollX)
                };
                
                // æ™ºèƒ½é€‰æ‹©æœ€ä½³ä½ç½®
                let bestPos = 'top'; // ä¿®æ”¹é»˜è®¤ä½ç½®ä¸ºä¸Šæ–¹
                let bestAlign = '';
                let bestAlignY = '';
                
                // ä¼˜å…ˆçº§ï¼šä¸Š > ä¸‹ > å³ > å·¦ (ä¿®æ”¹ä¼˜å…ˆçº§é¡ºåº)
                const positions = [
                    { pos: 'top', space: space.top, size: tooltipHeight + arrowSize + margin },
                    { pos: 'bottom', space: space.bottom, size: tooltipHeight + arrowSize + margin },
                    { pos: 'right', space: space.right, size: tooltipWidth + arrowSize + margin },
                    { pos: 'left', space: space.left, size: tooltipWidth + arrowSize + margin }
                ];
                
                // å¯»æ‰¾ç¬¬ä¸€ä¸ªæœ‰è¶³å¤Ÿç©ºé—´çš„ä½ç½®
                for (const { pos, space: availableSpace, size } of positions) {
                    if (availableSpace >= size) {
                        bestPos = pos;
                        break;
                    }
                }
                
                // è®¡ç®—å¯¹é½æ–¹å¼ä»¥é¿å…è¾¹ç¼˜æº¢å‡º
                if (bestPos === 'bottom' || bestPos === 'top') {
                    const centerX = rect.left + rect.width / 2;
                    const leftSpace = centerX;
                    const rightSpace = vw - centerX;
                    const halfTooltipWidth = tooltipWidth / 2;
                    
                    if (leftSpace < halfTooltipWidth + margin) {
                        bestAlign = 'left';
                    } else if (rightSpace < halfTooltipWidth + margin) {
                        bestAlign = 'right';
                    }
                } else if (bestPos === 'left' || bestPos === 'right') {
                    const centerY = rect.top + rect.height / 2;
                    const topSpace = centerY;
                    const bottomSpace = vh - centerY;
                    const halfTooltipHeight = tooltipHeight / 2;
                    
                    if (topSpace < halfTooltipHeight + margin) {
                        bestAlignY = 'top';
                    } else if (bottomSpace < halfTooltipHeight + margin) {
                        bestAlignY = 'bottom';
                    }
                }
                
                // æ¸…é™¤æ—§å±æ€§
                el.removeAttribute('data-tooltip-pos');
                el.removeAttribute('data-tooltip-align');
                el.removeAttribute('data-tooltip-align-y');
                
                // è®¾ç½®æ–°ä½ç½®å±æ€§
                el.setAttribute('data-tooltip-pos', bestPos);
                if (bestAlign) el.setAttribute('data-tooltip-align', bestAlign);
                if (bestAlignY) el.setAttribute('data-tooltip-align-y', bestAlignY);
                
                // è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
                if (window.DEBUG_TOOLTIP) {
                    console.log(`Tooltip positioned: ${bestPos}`, {
                        align: bestAlign,
                        alignY: bestAlignY,
                        space,
                        tooltipSize: { w: tooltipWidth, h: tooltipHeight }
                    });
                }
                
            } catch (error) {
                console.warn('Tooltip positioning failed:', error);
                // é™çº§åˆ°é»˜è®¤ä½ç½®
                el.setAttribute('data-tooltip-pos', 'bottom');
            }
        }

        // ä¼˜åŒ–çš„ tooltip åˆå§‹åŒ–ç³»ç»Ÿ
        function initTooltips(root) {
            const scope = root || document;
            const tooltipElements = scope.querySelectorAll('[data-tooltip]'); // æ‰©å±•ä¸ºæ‰€æœ‰å¸¦data-tooltipçš„å…ƒç´ 
            
            tooltipElements.forEach(el => {
                // é˜²æ­¢é‡å¤åˆå§‹åŒ–
                if (el.hasAttribute('data-tooltip-initialized')) return;
                el.setAttribute('data-tooltip-initialized', 'true');
                
                // ä¼˜åŒ–çš„äº‹ä»¶å¤„ç†
                let hoverTimer = null;
                
                // é¼ æ ‡è¿›å…¥æ—¶å»¶è¿Ÿè®¡ç®—ä½ç½®
                el.addEventListener('mouseenter', () => {
                    clearTimeout(hoverTimer);
                    hoverTimer = setTimeout(() => {
                        setTooltipPosition(el);
                    }, 50); // 50mså»¶è¿Ÿï¼Œé¿å…å¿«é€Ÿæ»‘è¿‡æ—¶çš„ä¸å¿…è¦è®¡ç®—
                });
                
                // é¼ æ ‡ç¦»å¼€æ—¶æ¸…é™¤è®¡æ—¶å™¨
                el.addEventListener('mouseleave', () => {
                    clearTimeout(hoverTimer);
                });
                
                // ç„¦ç‚¹äº‹ä»¶
                el.addEventListener('focus', () => {
                    setTooltipPosition(el);
                });
                
                // ä»…ä¸º.signå…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œå…¶ä»–å…ƒç´ åªç”¨æ‚¬åœ
                if (el.classList.contains('sign')) {
                    // ä¼˜åŒ–çš„ç‚¹å‡»å¤„ç†
                    el.addEventListener('click', (ev) => {
                        ev.preventDefault();
                        ev.stopPropagation();
                        
                        const isCurrentlyOpen = el.getAttribute('data-tooltip-open') === 'true';
                        
                        // å…³é—­å…¶ä»–å·²æ‰“å¼€çš„tooltip
                        document.querySelectorAll('[data-tooltip][data-tooltip-open="true"]')
                            .forEach(otherEl => {
                                if (otherEl !== el) {
                                    otherEl.removeAttribute('data-tooltip-open');
                                }
                            });
                        
                        // åˆ‡æ¢å½“å‰tooltipçŠ¶æ€
                        if (isCurrentlyOpen) {
                            el.removeAttribute('data-tooltip-open');
                        } else {
                            setTooltipPosition(el);
                            el.setAttribute('data-tooltip-open', 'true');
                        }
                    });
                    
                    // é”®ç›˜äº‹ä»¶æ”¯æŒ
                    el.addEventListener('keydown', (ev) => {
                        if (ev.key === 'Enter' || ev.key === ' ') {
                            ev.preventDefault();
                            el.click();
                        }
                    });
                }
            });
        }

        // å…¨å±€äº‹ä»¶å¤„ç†ä¼˜åŒ–
        let globalTooltipInitialized = false;
        
        function initGlobalTooltipEvents() {
            if (globalTooltipInitialized) return;
            globalTooltipInitialized = true;
            
            // ç‚¹å‡»ç©ºç™½åŒºåŸŸå…³é—­tooltip
            document.addEventListener('click', (e) => {
                if (!e.target.closest('[data-tooltip]')) {
                    document.querySelectorAll('[data-tooltip][data-tooltip-open="true"]')
                        .forEach(el => el.removeAttribute('data-tooltip-open'));
                }
            });
            
            // ESCé”®å…³é—­tooltip
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('[data-tooltip][data-tooltip-open="true"]')
                        .forEach(el => el.removeAttribute('data-tooltip-open'));
                }
            });
            
            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¡ç®—ä½ç½®
            let resizeTimer = null;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    document.querySelectorAll('[data-tooltip][data-tooltip-open="true"]')
                        .forEach(el => setTooltipPosition(el));
                }, 100);
            });
            
            // æ»šåŠ¨æ—¶é‡æ–°è®¡ç®—ä½ç½®
            let scrollTimer = null;
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimer);
                scrollTimer = setTimeout(() => {
                    document.querySelectorAll('[data-tooltip][data-tooltip-open="true"]')
                        .forEach(el => setTooltipPosition(el));
                }, 50);
            }, { passive: true });
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å…¨å±€äº‹ä»¶
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGlobalTooltipEvents);
        } else {
            initGlobalTooltipEvents();
        }
        
         // æ–°å¢ï¼šæ˜¾ç¤ºç”Ÿè¾°ä¿¡æ¯
         function displayBirthInfo(maleInfo, femaleInfo, maleDate, femaleDate) {
             const panel = document.getElementById('birth-info-panel');
             const groomDetails = document.getElementById('groom-details');
             const brideDetails = document.getElementById('bride-details');
             
             // æ ¼å¼åŒ–ç”Ÿæ—¥æ˜¾ç¤º
             const formatBirthDate = (date) => {
                 const year = date.getFullYear();
                 const month = (date.getMonth() + 1).toString().padStart(2, '0');
                 const day = date.getDate().toString().padStart(2, '0');
                 const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
                 const weekday = weekdays[date.getDay()];
                 return `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
             };
             
             // ç”Ÿæˆæ–°éƒä¿¡æ¯
             groomDetails.innerHTML = `
                 <div class="birth-detail-item">
                     <strong>å…¬å†ï¼š</strong>${formatBirthDate(maleDate)}
                 </div>
                 <div class="birth-detail-item">
                     <strong>å†œå†ï¼š</strong>${maleInfo.lunarDate}
                 </div>
                 <div class="birth-detail-item">
                     <strong>å¹²æ”¯ï¼š</strong>${maleInfo.yearGanzhi} å¹´ (å±${maleInfo.shengxiao})
                 </div>
                 <div class="birth-detail-item">
                     <strong>äº”è¡Œï¼š</strong>${maleInfo.yearWuxing}å‘½
                 </div>
             `;
             
             // ç”Ÿæˆæ–°å¨˜ä¿¡æ¯
             brideDetails.innerHTML = `
                 <div class="birth-detail-item">
                     <strong>å…¬å†ï¼š</strong>${formatBirthDate(femaleDate)}
                 </div>
                 <div class="birth-detail-item">
                     <strong>å†œå†ï¼š</strong>${femaleInfo.lunarDate}
                 </div>
                 <div class="birth-detail-item">
                     <strong>å¹²æ”¯ï¼š</strong>${femaleInfo.yearGanzhi} å¹´ (å±${femaleInfo.shengxiao})
                 </div>
                 <div class="birth-detail-item">
                     <strong>äº”è¡Œï¼š</strong>${femaleInfo.yearWuxing}å‘½
                 </div>
             `;
             
             // æ˜¾ç¤ºé¢æ¿
             panel.style.display = 'block';
         }
         
         // æ˜¾ç¤ºè®¡ç®—ç»“æœ
         function displayResults(results, maleInfo, femaleInfo) {
            const container = document.getElementById('result-container');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å‰æ—¥ï¼Œè¯·æ‰©å¤§æŸ¥è¯¢èŒƒå›´</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ¨èæŒ‡æ•°æ’åº
            results.sort((a, b) => b.score - a.score);
            
            // åªæ˜¾ç¤ºå‰20ä¸ªç»“æœ
            const topResults = results.slice(0, 20);
            
            let html = '';
            topResults.forEach(result => {
                // æ ¼å¼åŒ–æ—¥æœŸ
                const solarDateStr = formatSolarDateForDisplay(result.solarDate); // æ”¹ä¸ºä¸­æ–‡é˜³å†+æ˜ŸæœŸæ ¼å¼æ˜¾ç¤º
                 
                 // åˆ›å»ºæ˜Ÿçº§è¯„ä»·
                 const stars = 'â˜…'.repeat(result.score) + 'â˜†'.repeat(5 - result.score);
                 
                 // åˆ›å»ºå‰ç¥å’ŒåäºŒå»ºæ˜Ÿæ ‡ç­¾ï¼ˆå¸¦ tooltipï¼‰
                 const dayZhi = result.ganzhi && result.ganzhi.length >= 2 ? result.ganzhi[1] : '';
                 
                 // æ·»åŠ åäºŒå»ºæ˜Ÿï¼ˆä¼ ç»Ÿæ–‡åŒ–æ ¸å¿ƒï¼‰
                 let signsHTML = `<div class="sign traditional-star" tabindex="0" data-tooltip="${escapeAttr(getBuilderExplanation(result.builder))}">
                     <i class="fas fa-star"></i>${result.builder}æ˜Ÿ
                 </div>`;
                 
                 // æ·»åŠ ä¼ ç»Ÿå‰ç¥
                 signsHTML += result.signs.map(sign => {
                     const tip = getSignExplanation(sign, dayZhi);
                     return `<div class="sign" tabindex="0" data-tooltip="${escapeAttr(tip)}"><i class="fas fa-star"></i>${sign}</div>`;
                 }).join('');
                 
                 // ä¸ºå¹²æ”¯ã€ç”Ÿè‚–å†²ã€äº”è¡Œæ·»åŠ æç¤ºæ–‡æœ¬
                 const ganzhiTip = getGanzhiExplanation(result.ganzhi);
                 const chongTip = getChongExplanation(result.chongShengxiao, result.ganzhi);
                 const wuxingTip = getWuxingExplanation(WUXING[DIZHI.indexOf(result.ganzhi[1])], result.ganzhi);
                 
                 html += `
                     <div class="date-card">
                         <div class="date-header">
                             <div>
                                 <span class="solar-date"><i class="fas fa-calendar-day"></i>${solarDateStr}</span>
                                 <span class="lunar-date">å†œå† ${result.lunarDate}</span>
                             </div>
                             <span class="ganzhi" tabindex="0" data-tooltip="${escapeAttr(ganzhiTip)}">${result.ganzhi}</span>
                         </div>
                         <div class="details">
                             <div class="detail-item">
                                 <div class="detail-label">æ¨èæŒ‡æ•°</div>
                                 <div class="stars">${stars}</div>
                             </div>
                             <div class="detail-item">
                                 <div class="detail-label">ç”Ÿè‚–å†²</div>
                                 <div class="detail-value" tabindex="0" data-tooltip="${escapeAttr(chongTip)}">${result.chongShengxiao}</div>
                             </div>
                             <div class="detail-item">
                                 <div class="detail-label">äº”è¡Œ</div>
                                 <div class="detail-value" tabindex="0" data-tooltip="${escapeAttr(wuxingTip)}">${WUXING[DIZHI.indexOf(result.ganzhi[1])]}</div>
                             </div>
                         </div>
                         <div class="auspicious-signs">
                             ${signsHTML}
                         </div>
                     </div>
                 `;
             });
             
             container.innerHTML = html;
             
             // åˆå§‹åŒ–å…¨å±€tooltipäº‹ä»¶ï¼ˆå¦‚æœè¿˜æœªåˆå§‹åŒ–ï¼‰
             initGlobalTooltipEvents();
             
             // åˆå§‹åŒ–æ–°æ¸²æŸ“å…ƒç´ çš„tooltipäº¤äº’
             initTooltips(container);
         }
         
         // æ˜¾ç¤ºè®¡ç®—é”™è¯¯
         function showCalculationError(message) {
             const container = document.getElementById('result-container');
             container.innerHTML = `
                 <div class="error-box">
                     <i class="fas fa-bug"></i>
                     <h3>è®¡ç®—å¤±è´¥</h3>
                     <p>${message || 'è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯'}</p>
                     <button class="retry-btn" onclick="location.reload()">é‡æ–°åŠ è½½</button>
                 </div>
             `;
         }
         
         // æ ¼å¼åŒ–æ—¥æœŸä¸ºYYYY-MM-DD
         function formatDate(date) {
             const year = date.getFullYear();
             const month = (date.getMonth() + 1).toString().padStart(2, '0');
             const day = date.getDate().toString().padStart(2, '0');
             return `${year}-${month}-${day}`;
         }
        // æ–°å¢ï¼šæ ¼å¼åŒ–é˜³å†æ—¥æœŸï¼ˆä¸­æ–‡+æ˜ŸæœŸï¼‰ï¼Œå¦‚â€œé˜³å† 2025å¹´08æœˆ26æ—¥ å‘¨äºŒâ€
        function formatSolarDateForDisplay(date) {
            // ç”Ÿæˆå¹´ã€æœˆã€æ—¥ï¼Œç»Ÿä¸€ä¸¤ä½æ•°
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            // æ˜ å°„æ˜ŸæœŸ
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            const weekday = weekdays[date.getDay()];
            // è¿”å›ç›®æ ‡æ˜¾ç¤ºæ ¼å¼
            return `é˜³å† ${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
        }
    </script>
</body>
</html>